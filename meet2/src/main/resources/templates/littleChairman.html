<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>论坛主席界面</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="../static/css/forumChair.css">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui@2.15.1/lib/index.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        @import url("//unpkg.com/element-ui@2.15.1/lib/theme-chalk/index.css");
    </style>
</head>
<body>
<header>
    <h1>论坛信息</h1>
</header>
<div id="app">
    <template>
        <el-table
                :data="tableData"
                style="width:100%">
            <el-table-column
                    prop="topics"
                    label="论坛议题"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="date"
                    label="时间"
                    width="150">
            </el-table-column>
            <el-table-column
                    prop="num_post"
                    label="帖子数"
                    width="100">
            </el-table-column>
            <el-table-column
                    prop="num_user"
                    label="议题讨论人数"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="operation"
                    label="操作"
                    width="120">
                <template slot-scope="scope">
                    <el-button
                            type = "text"
                            @click = "handleClick(scope.row)"
                            size = "small">
                        发送通知
                    </el-button>
                </template>
            </el-table-column>
        </el-table>
    </template>
</div>

</body>

<script>
 var tableData= [{
                topics: '术语社会科学（SS）',
                date: '2020-08-09',
                num_post: '10',
                num_user: ''
            }]

    window.onload = function(){
    var href=window.location.search;
    var word = href.substring(href.lastIndexOf('=')+1, href.length);//获取要搜索的数据
    if(word!='')
    {
        $.ajax(
        {
            url: 'http://localhost:8080/getpeople',
            type: 'get',
            data: {},
            dataType: 'json'
            }).then(function (res) 
            {
                tableData[0]["num_user"] = res[0]
            }).fail(function () 
            {
                console.log('失败');
            })
    }
    }

var Main = {
    methods: {
        handleClick(row) {
            if(row.topics == '术语社会科学（SS）' ){
                window.location.href="addmsg.html?data=1";
            }
            else{
                window.location.href="addmsg.html?data=2";
            }
        }
    },
    data() {
        return {
           tableData
        }
    }
}
var Ctor = Vue.extend(Main)
new Ctor().$mount('#app')
</script>
</html>